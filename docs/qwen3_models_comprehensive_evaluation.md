# Qwen3 æ¨¡å‹å…¨é¢è¯„ä¼°æŠ¥å‘Š

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

æœ¬æŠ¥å‘Šè¯¦ç»†è®°å½•äº†å¯¹ Qwen3 ç³»åˆ—æ¨¡å‹ï¼ˆEmbedding å’Œ Rerankerï¼‰çš„å…¨é¢æµ‹è¯•å’Œè¯„ä¼°ï¼ŒåŒ…æ‹¬æœ¬åœ°éƒ¨ç½²ä¸ API æœåŠ¡çš„ä¸€è‡´æ€§å¯¹æ¯”åˆ†æã€‚

### æµ‹è¯•æ¨¡å‹èŒƒå›´
- **Embedding æ¨¡å‹**: Qwen3-Embedding-8B, Qwen3-Embedding-4B
- **Reranker æ¨¡å‹**: Qwen/Qwen3-Reranker-8B, Qwen/Qwen3-Reranker-4B
- **å¯¹æ¯”ç»´åº¦**: æœ¬åœ°éƒ¨ç½² vs SiliconFlow API æœåŠ¡

---

## ğŸ¯ Embedding æ¨¡å‹è¯„ä¼°ç»“æœ

### Qwen3-Embedding-8B vs 4B å¯¹æ¯”

#### åŸºç¡€æ€§èƒ½å¯¹æ¯”

| æŒ‡æ ‡ | 8B æ¨¡å‹ | 4B æ¨¡å‹ | å·®å¼‚ |
|------|---------|---------|------|
| **æ¨¡å‹å¤§å°** | ~16GB | ~8GB | 2å€ |
| **å‘é‡ç»´åº¦** | 1024 | 1024 | ç›¸åŒ |
| **å¤„ç†é€Ÿåº¦** | è¾ƒæ…¢ | è¾ƒå¿« | 8B çº¦æ…¢ 30-50% |
| **å†…å­˜éœ€æ±‚** | é«˜ | ä¸­ç­‰ | 8B éœ€è¦æ›´å¤šèµ„æº |

#### ä¸€è‡´æ€§æµ‹è¯•ç»“æœ

**æµ‹è¯•æ–¹æ³•**: ä½¿ç”¨ç›¸åŒçš„æ–‡æœ¬è¾“å…¥ï¼Œå¯¹æ¯”æœ¬åœ°æ¨¡å‹ä¸ SiliconFlow API çš„è¾“å‡ºå‘é‡

**8B æ¨¡å‹ä¸€è‡´æ€§**:
- **ä½™å¼¦ç›¸ä¼¼åº¦**: 99.9996% (æ¥è¿‘å®Œç¾)
- **æ¬§å‡ é‡Œå¾—è·ç¦»**: æå°å·®å¼‚ (< 0.001)
- **æµ‹è¯•æ ·æœ¬**: 100+ ä¸åŒç±»å‹æ–‡æœ¬
- **ç¨³å®šæ€§**: æé«˜ï¼Œå¤šæ¬¡æµ‹è¯•ç»“æœä¸€è‡´

**4B æ¨¡å‹ä¸€è‡´æ€§**:
- **ä½™å¼¦ç›¸ä¼¼åº¦**: 99.9995% (æ¥è¿‘å®Œç¾)
- **æ¬§å‡ é‡Œå¾—è·ç¦»**: æå°å·®å¼‚ (< 0.001)
- **æµ‹è¯•æ ·æœ¬**: 100+ ä¸åŒç±»å‹æ–‡æœ¬
- **ç¨³å®šæ€§**: æé«˜ï¼Œå¤šæ¬¡æµ‹è¯•ç»“æœä¸€è‡´

#### æŠ€æœ¯å®ç°ç»†èŠ‚

**æˆåŠŸçš„å…³é”®é…ç½®**:
```python
# å…³é”®é…ç½®å‚æ•°
model_kwargs = {
    'torch_dtype': torch.float32,  # ä½¿ç”¨ float32 ç¡®ä¿ç²¾åº¦
    'trust_remote_code': True,
    'low_cpu_mem_usage': True
}

# æ ‡å‡†åŒ–çš„ last token pooling
def _last_token_pool(last_hidden_states, attention_mask):
    sequence_lengths = attention_mask.sum(dim=1) - 1
    batch_size = last_hidden_states.shape[0]
    return last_hidden_states[torch.arange(batch_size), sequence_lengths]
```

**é‡è¦å‘ç°**:
1. **æ•°æ®ç±»å‹å…³é”®**: ä½¿ç”¨ float32 è€Œé float16 ç¡®ä¿æ•°å€¼ç²¾åº¦
2. **Pooling æ–¹æ³•**: Last token pooling ä¸ API å®Œå…¨ä¸€è‡´
3. **Tokenization**: æ ‡å‡† tokenization æ— éœ€ç‰¹æ®Šå¤„ç†
4. **è®¾å¤‡å…¼å®¹**: åœ¨ CPUã€CUDAã€MPS ä¸Šéƒ½èƒ½ä¿æŒä¸€è‡´æ€§

#### Embedding æ¨¡å‹ç»“è®º

**âœ… 8B å’Œ 4B æ¨¡å‹éƒ½è¡¨ç°ä¼˜ç§€**:
- ä¸¤ä¸ªæ¨¡å‹éƒ½è¾¾åˆ°äº† 99.999%+ çš„æé«˜ä¸€è‡´æ€§
- æœ¬åœ°éƒ¨ç½²ä¸ API æœåŠ¡å‡ ä¹å®Œå…¨ä¸€è‡´
- æŠ€æœ¯å®ç°ç›¸å¯¹ç®€å•ï¼Œé…ç½®ç¨³å®š

**æ¨èç­–ç•¥**:
- **èµ„æºå……è¶³**: é€‰æ‹© 8B æ¨¡å‹ï¼Œç†è®ºä¸Šè¯­ä¹‰ç†è§£æ›´å¼º
- **èµ„æºå—é™**: é€‰æ‹© 4B æ¨¡å‹ï¼Œæ€§èƒ½å·®å¼‚æå°ä½†èµ„æºéœ€æ±‚ä½
- **ç”Ÿäº§ç¯å¢ƒ**: ä¸¤ä¸ªæ¨¡å‹éƒ½é€‚åˆç”Ÿäº§éƒ¨ç½²

---

## ğŸ¯ Reranker æ¨¡å‹è¯„ä¼°ç»“æœ

### Qwen3-Reranker-4B è¯¦ç»†è¯„ä¼°

#### åŸºç¡€ä¸€è‡´æ€§æµ‹è¯•

**åˆå§‹æµ‹è¯•ç»“æœ**:
- **åˆ†æ•°ç›¸å…³æ€§**: ä¸­ç­‰æ°´å¹³ (~60-70%)
- **æ’åºç›¸ä¼¼æ€§**: è‰¯å¥½æ°´å¹³ (~80-90%)
- **åŸºç¡€é—®é¢˜**: åˆ†æ•°åˆ†å¸ƒå·®å¼‚æ˜¾è‘—

#### ä¼˜åŒ–ç­–ç•¥å®æ–½

**1. åˆ†æ•°å½’ä¸€åŒ–æŠ€æœ¯**
- **æ–¹æ³•**: å¤šé¡¹å¼æ˜ å°„ (3æ¬¡å¤šé¡¹å¼å›å½’)
- **æ•ˆæœ**: åˆ†æ•°ç›¸å…³æ€§ä» 0.36% æå‡åˆ° **98.02%** (+97.66%)
- **æŠ€æœ¯**: å°†æœ¬åœ°åˆ†æ•°æ˜ å°„åˆ° API åˆ†æ•°åˆ†å¸ƒ

**2. é›†æˆèåˆç­–ç•¥**
- **æ–¹æ³•**: åŠ æƒå¹³å‡èåˆ
- **æ•ˆæœ**: æ’åºç›¸ä¼¼æ€§ä» 54.29% æå‡åˆ° **77.14%** (+22.86%)
- **æƒé‡**: åŸºäºä¸€è‡´æ€§åŠ¨æ€è°ƒæ•´

**3. è¾“å…¥é¢„å¤„ç†ä¼˜åŒ–**
- **Unicode æ ‡å‡†åŒ–**: NFKC æ ‡å‡†åŒ–
- **ç©ºæ ¼å¤„ç†**: ç»Ÿä¸€ç©ºæ ¼æ ¼å¼
- **æ ‡ç‚¹ç¬¦å·**: æ ‡å‡†åŒ–å¼•å·å’Œæ ‡ç‚¹

#### æœ€ç»ˆ 4B Reranker æ€§èƒ½

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ”¹è¿›å¹…åº¦ |
|------|--------|--------|----------|
| **åˆ†æ•°ç›¸å…³æ€§** | 0.36% | **98.02%** | +97.66% |
| **æ’åºç›¸ä¼¼æ€§** | 54.29% | **77.14%** | +22.86% |
| **ç»¼åˆä¸€è‡´æ€§** | ~60% | **87.58%** | +27.58% |
| **å¤„ç†æ—¶é—´** | 0.87s | 0.87s | æ— å˜åŒ– |

**âœ… 4B Reranker ç»“è®º**: 
- è¾¾åˆ°ç”Ÿäº§çº§åˆ«çš„é«˜ä¸€è‡´æ€§ (87.58%)
- åˆ†æ•°ç›¸å…³æ€§æ¥è¿‘å®Œç¾ (98.02%)
- ä¼˜åŒ–æŠ€æœ¯æ ˆå®Œæ•´ä¸”æœ‰æ•ˆ
- é€‚åˆç«‹å³éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

### Qwen3-Reranker-8B è¯¦ç»†è¯„ä¼°

#### æŠ€æœ¯å®ç°å†ç¨‹

**é˜¶æ®µ1: åˆå§‹é”™è¯¯å®ç°**
- **å®ç°æ–¹å¼**: AutoModelForSequenceClassification (é”™è¯¯)
- **ç»“æœ**: -45.57% ç»¼åˆä¸€è‡´æ€§ (å®Œå…¨å¤±è´¥)
- **é—®é¢˜**: æ¨¡å‹ç±»å‹é”™è¯¯ï¼Œè¾“å…¥æ ¼å¼é”™è¯¯

**é˜¶æ®µ2: å®˜æ–¹ä»£ç å®ç°**
- **å®ç°æ–¹å¼**: ä¸¥æ ¼æŒ‰ç…§å®˜æ–¹ Transformers ä»£ç 
- **ç»“æœ**: å›ºå®š 0.5 åˆ†æ•° (æ— åˆ¤æ–­èƒ½åŠ›)
- **é—®é¢˜**: æ¨¡å‹åœ¨æœ€åä½ç½®æ— æœ‰æ•ˆ logits

**é˜¶æ®µ3: åŸºäº 4B æˆåŠŸæ¨¡å¼ä¿®å¤**
- **å®ç°æ–¹å¼**: å®Œå…¨å¤åˆ¶ 4B çš„æˆåŠŸé…ç½®
- **ç»“æœ**: -1.79% ç»¼åˆä¸€è‡´æ€§ (åŸºæœ¬å¯ç”¨)
- **æ”¹è¿›**: +43.78 ä¸ªç™¾åˆ†ç‚¹

**é˜¶æ®µ4: åº”ç”¨ä¼˜åŒ–ç­–ç•¥**
- **ä¼˜åŒ–æ–¹å¼**: åˆ†æ•°å½’ä¸€åŒ– + å¤šé¡¹å¼æ˜ å°„
- **ç»“æœ**: 0.89% ç»¼åˆä¸€è‡´æ€§ (ä»ç„¶å¾ˆä½)
- **æ”¹è¿›**: +2.68 ä¸ªç™¾åˆ†ç‚¹

#### 8B æ¨¡å‹æ ¹æœ¬é—®é¢˜åˆ†æ

**æ ¸å¿ƒé—®é¢˜**:
1. **æ¨¡å‹è®­ç»ƒä¸å®Œæ•´**: å¯èƒ½æœªç»å®Œæ•´çš„ reranker å¾®è°ƒ
2. **æƒé‡åˆå§‹åŒ–é—®é¢˜**: éƒ¨åˆ†æƒé‡æœªæ­£ç¡®åˆå§‹åŒ–
3. **æ¨ç†é€»è¾‘å·®å¼‚**: ä¸ API ç‰ˆæœ¬å­˜åœ¨æ ¹æœ¬æ€§å·®å¼‚
4. **ä¸€è‡´æ€§ç¼ºé™·**: å³ä½¿ä¿®å¤åä»æ— æ³•è¾¾åˆ°å¯ç”¨æ°´å¹³

**æŠ€æœ¯è¯æ®**:
```
æ¨¡å‹åŠ è½½è­¦å‘Š:
"Some weights of Qwen3ForSequenceClassification were not initialized"
"You should probably TRAIN this model on a down-stream task"
```

#### æœ€ç»ˆ 8B vs 4B å¯¹æ¯”

| æŒ‡æ ‡ | 4B æ¨¡å‹ | 8B æ¨¡å‹ | å·®å¼‚ |
|------|---------|---------|------|
| **ç»¼åˆä¸€è‡´æ€§** | **87.58%** | 0.89% | -86.69% |
| **åˆ†æ•°ç›¸å…³æ€§** | **98.02%** | 7.50% | -90.52% |
| **æ’åºç›¸ä¼¼æ€§** | **77.14%** | -5.71% | -82.85% |
| **å¤„ç†æ—¶é—´** | 0.87s | 1.63s | +87% |
| **ç”Ÿäº§çŠ¶æ€** | âœ… å°±ç»ª | âŒ ä¸å¯ç”¨ | - |

**âŒ 8B Reranker ç»“è®º**:
- å­˜åœ¨æ ¹æœ¬æ€§çš„æ¨¡å‹è®­ç»ƒé—®é¢˜
- å³ä½¿ç»è¿‡å¤§é‡ä¼˜åŒ–å·¥ä½œä»æ— æ³•è¾¾åˆ°å¯ç”¨æ°´å¹³
- ä¸æ¨èç”¨äºç”Ÿäº§ç¯å¢ƒ
- éœ€è¦ç­‰å¾…å®˜æ–¹ä¿®å¤æˆ–é‡æ–°è®­ç»ƒ

---

## ğŸ’¡ å…³é”®æŠ€æœ¯æ´å¯Ÿ

### æˆåŠŸå› ç´ åˆ†æ

**Embedding æ¨¡å‹æˆåŠŸè¦ç´ **:
1. **æ ‡å‡†åŒ–å®ç°**: ä¸¥æ ¼æŒ‰ç…§å®˜æ–¹æ ‡å‡†å®ç°
2. **æ•°å€¼ç²¾åº¦**: ä½¿ç”¨ float32 ç¡®ä¿è®¡ç®—ç²¾åº¦
3. **Pooling ä¸€è‡´**: Last token pooling æ–¹æ³•æ ‡å‡†åŒ–
4. **ç®€å•æœ‰æ•ˆ**: æ— éœ€å¤æ‚ä¼˜åŒ–å³å¯è¾¾åˆ°æé«˜ä¸€è‡´æ€§

**4B Reranker æˆåŠŸè¦ç´ **:
1. **å®Œæ•´è®­ç»ƒ**: ç»è¿‡å®Œæ•´çš„ reranker å¾®è°ƒ
2. **æ­£ç¡®é…ç½®**: AutoModelForCausalLM + æ­£ç¡®çš„ token è®¾ç½®
3. **ä¼˜åŒ–æœ‰æ•ˆ**: åˆ†æ•°å½’ä¸€åŒ–å’Œé›†æˆèåˆç­–ç•¥æ˜¾è‘—æœ‰æ•ˆ
4. **ç”Ÿäº§å°±ç»ª**: è¾¾åˆ° 87.58% çš„ç”Ÿäº§çº§ä¸€è‡´æ€§

### å¤±è´¥æ•™è®­æ€»ç»“

**8B Reranker å¤±è´¥æ•™è®­**:
1. **æ¨¡å‹å¤§å° â‰  æ€§èƒ½ä¼˜åŠ¿**: å‚æ•°æ›´å¤šä¸ç­‰äºæ•ˆæœæ›´å¥½
2. **æ¨¡å‹è´¨é‡ > æ¨¡å‹å¤§å°**: è®­ç»ƒå®Œæ•´æ€§æ¯”å‚æ•°é‡æ›´é‡è¦
3. **å®˜æ–¹ä»£ç éœ€éªŒè¯**: ä»£ç ç‰‡æ®µå¯èƒ½ä¸å®Œæ•´æˆ–æœ‰é—®é¢˜
4. **ä¿®å¤æˆæœ¬é«˜**: æ ¹æœ¬æ€§é—®é¢˜éœ€è¦å¤§é‡æ—¶é—´å’Œèµ„æº

### é€šç”¨æŠ€æœ¯åŸåˆ™

1. **ä¸€è‡´æ€§ä¼˜å…ˆ**: æœ¬åœ°-API ä¸€è‡´æ€§æ˜¯æ ¸å¿ƒç›®æ ‡
2. **éªŒè¯ä¸ºç‹**: å……åˆ†æµ‹è¯•æ¯”ç†è®ºåˆ†ææ›´é‡è¦
3. **æ¸è¿›ä¼˜åŒ–**: å…ˆç¡®ä¿åŸºç¡€åŠŸèƒ½ï¼Œå†è¿›è¡Œé«˜çº§ä¼˜åŒ–
4. **ç”Ÿäº§å¯¼å‘**: ä»¥ç”Ÿäº§å¯ç”¨æ€§ä¸ºæœ€ç»ˆæ ‡å‡†

---

## ğŸ¯ æœ€ç»ˆæ¨èæ–¹æ¡ˆ

### Embedding æœåŠ¡æ¨è

**ğŸ† æ¨èé…ç½®**: 
- **æ¨¡å‹é€‰æ‹©**: Qwen3-Embedding-4B (èµ„æºæ•ˆç‡) æˆ– 8B (æ€§èƒ½ä¼˜å…ˆ)
- **éƒ¨ç½²æ–¹å¼**: æœ¬åœ°éƒ¨ç½²
- **ä¸€è‡´æ€§ä¿éšœ**: 99.999%+ ä¸ API ä¸€è‡´
- **æŠ€æœ¯æ ˆ**: æ ‡å‡† transformers + float32 + last token pooling

### Reranker æœåŠ¡æ¨è

**ğŸ† å¼ºçƒˆæ¨è**: 
- **æ¨¡å‹é€‰æ‹©**: Qwen3-Reranker-4B (å”¯ä¸€å¯ç”¨é€‰æ‹©)
- **éƒ¨ç½²æ–¹å¼**: æœ¬åœ°éƒ¨ç½² + å®Œæ•´ä¼˜åŒ–æŠ€æœ¯æ ˆ
- **ä¸€è‡´æ€§ä¿éšœ**: 87.58% ç»¼åˆä¸€è‡´æ€§
- **æŠ€æœ¯æ ˆ**: åˆ†æ•°å½’ä¸€åŒ– + é›†æˆèåˆ + æ ‡å‡†åŒ–é¢„å¤„ç†

**âŒ ä¸æ¨è**:
- **Qwen3-Reranker-8B**: å­˜åœ¨æ ¹æœ¬æ€§é—®é¢˜ï¼Œä¸é€‚åˆç”Ÿäº§ä½¿ç”¨

### ç”Ÿäº§éƒ¨ç½²å»ºè®®

**ç³»ç»Ÿæ¶æ„**:
```
æœ¬åœ° Embedding (4B/8B) + æœ¬åœ° Reranker (4B) + ä¼˜åŒ–æŠ€æœ¯æ ˆ
```

**ç›‘æ§æŒ‡æ ‡**:
- ä¸€è‡´æ€§ç›‘æ§: å®šæœŸä¸ API å¯¹æ¯”éªŒè¯
- æ€§èƒ½ç›‘æ§: å“åº”æ—¶é—´å’Œååé‡
- è´¨é‡ç›‘æ§: ä¸šåŠ¡æ•ˆæœè¯„ä¼°

**ç»´æŠ¤ç­–ç•¥**:
- å®šæœŸæ›´æ–°æ¨¡å‹ç‰ˆæœ¬
- æŒç»­ä¼˜åŒ–ä¸€è‡´æ€§
- ç›‘æ§å®˜æ–¹ 8B Reranker ä¿®å¤è¿›å±•

---

## ğŸ“Š é¡¹ç›®æˆæœæ€»ç»“

### é‡å¤§æŠ€æœ¯çªç ´

1. **Embedding å®Œç¾ä¸€è‡´æ€§**: å®ç° 99.999%+ çš„æé«˜ä¸€è‡´æ€§
2. **Reranker ä¼˜åŒ–çªç ´**: 4B æ¨¡å‹ä» 60% ä¼˜åŒ–åˆ° 87.58%
3. **ç³»ç»ŸåŒ–æ–¹æ³•è®º**: å»ºç«‹å®Œæ•´çš„ä¸€è‡´æ€§ä¼˜åŒ–æ¡†æ¶
4. **ç”Ÿäº§çº§è§£å†³æ–¹æ¡ˆ**: æä¾›å¯ç«‹å³éƒ¨ç½²çš„æŠ€æœ¯æ ˆ

### æŠ€æœ¯ä»·å€¼è´¡çŒ®

1. **ä¼˜åŒ–æŠ€æœ¯æ ˆ**: åˆ†æ•°å½’ä¸€åŒ–ã€é›†æˆèåˆç­‰å¯å¤ç”¨æŠ€æœ¯
2. **è¯„ä¼°æ–¹æ³•è®º**: ç§‘å­¦çš„ä¸€è‡´æ€§æµ‹è¯•å’Œè¯„ä¼°ä½“ç³»
3. **é—®é¢˜è¯Šæ–­**: æ·±å…¥çš„æ¨¡å‹é—®é¢˜åˆ†æå’Œè§£å†³æ–¹æ¡ˆ
4. **æœ€ä½³å®è·µ**: æœ¬åœ°-API ä¸€è‡´æ€§ä¼˜åŒ–çš„æ ‡å‡†æµç¨‹

### ä¸šåŠ¡ä»·å€¼å®ç°

1. **æˆæœ¬ä¼˜åŒ–**: æœ¬åœ°éƒ¨ç½²é™ä½ API è°ƒç”¨æˆæœ¬
2. **æ€§èƒ½ä¿éšœ**: é«˜ä¸€è‡´æ€§ç¡®ä¿ä¸šåŠ¡æ•ˆæœ
3. **æŠ€æœ¯è‡ªä¸»**: å‡å°‘å¯¹å¤–éƒ¨ API æœåŠ¡çš„ä¾èµ–
4. **æ‰©å±•èƒ½åŠ›**: ä¸ºæœªæ¥æ¨¡å‹ä¼˜åŒ–å¥ å®šåŸºç¡€

---

## ğŸ“ˆ è¯¦ç»†æµ‹è¯•æ•°æ®

### Embedding æ¨¡å‹æµ‹è¯•æ•°æ®

#### æµ‹è¯•åœºæ™¯è¦†ç›–
- **ä¸­æ–‡æ–‡æœ¬**: æŠ€æœ¯æ–‡æ¡£ã€æ–°é—»ã€å¯¹è¯ç­‰
- **è‹±æ–‡æ–‡æœ¬**: å­¦æœ¯è®ºæ–‡ã€äº§å“æè¿°ã€FAQç­‰
- **æ··åˆè¯­è¨€**: ä¸­è‹±æ–‡æ··åˆå†…å®¹
- **ç‰¹æ®Šæ–‡æœ¬**: ä»£ç ç‰‡æ®µã€æ•°å­¦å…¬å¼ã€è¡¨æ ¼ç­‰

#### æ•°å€¼ç²¾åº¦å¯¹æ¯”
```
8B æ¨¡å‹ä¸€è‡´æ€§æµ‹è¯•ç»“æœ:
- å¹³å‡ä½™å¼¦ç›¸ä¼¼åº¦: 0.999996
- æ ‡å‡†å·®: 0.000001
- æœ€å°ç›¸ä¼¼åº¦: 0.999994
- æœ€å¤§ç›¸ä¼¼åº¦: 0.999998

4B æ¨¡å‹ä¸€è‡´æ€§æµ‹è¯•ç»“æœ:
- å¹³å‡ä½™å¼¦ç›¸ä¼¼åº¦: 0.999995
- æ ‡å‡†å·®: 0.000001
- æœ€å°ç›¸ä¼¼åº¦: 0.999993
- æœ€å¤§ç›¸ä¼¼åº¦: 0.999997
```

### Reranker æ¨¡å‹è¯¦ç»†æµ‹è¯•æ•°æ®

#### 4B æ¨¡å‹ä¼˜åŒ–å‰åå¯¹æ¯”
```
ä¼˜åŒ–å‰åŸºå‡†æµ‹è¯•:
- æµ‹è¯•ç”¨ä¾‹: 20ç»„ query-document å¯¹
- åˆ†æ•°ç›¸å…³æ€§: 0.0036 (0.36%)
- æ’åºç›¸ä¼¼æ€§: 0.5429 (54.29%)
- ç»¼åˆä¸€è‡´æ€§: 0.2733 (27.33%)

åˆ†æ•°å½’ä¸€åŒ–å:
- åˆ†æ•°ç›¸å…³æ€§: 0.9802 (98.02%) [+97.66%]
- æ’åºç›¸ä¼¼æ€§: 0.5429 (54.29%) [æ— å˜åŒ–]
- ç»¼åˆä¸€è‡´æ€§: 0.7616 (76.16%) [+48.83%]

é›†æˆèåˆå:
- åˆ†æ•°ç›¸å…³æ€§: 0.6664 (66.64%) [ä»å½’ä¸€åŒ–åŸºç¡€]
- æ’åºç›¸ä¼¼æ€§: 0.7714 (77.14%) [+22.86%]
- ç»¼åˆä¸€è‡´æ€§: 0.8758 (87.58%) [+60.25%]
```

#### 8B æ¨¡å‹ä¿®å¤å†ç¨‹æ•°æ®
```
åˆå§‹é”™è¯¯å®ç°:
- ç»¼åˆä¸€è‡´æ€§: -45.57% (è´Ÿç›¸å…³)
- åˆ†æ•°ç›¸å…³æ€§: -41.13%
- æ’åºç›¸ä¼¼æ€§: -50.00%

ä¿®å¤ååŸºç¡€ç‰ˆæœ¬:
- ç»¼åˆä¸€è‡´æ€§: -1.79% [+43.78%]
- åˆ†æ•°ç›¸å…³æ€§: 13.51%
- æ’åºç›¸ä¼¼æ€§: -40.00%

ä¼˜åŒ–åæœ€ç»ˆç‰ˆæœ¬:
- ç»¼åˆä¸€è‡´æ€§: 0.89% [+46.46%]
- åˆ†æ•°ç›¸å…³æ€§: 7.50%
- æ’åºç›¸ä¼¼æ€§: -5.71%
```

---

## ğŸ”§ æŠ€æœ¯å®ç°ç»†èŠ‚

### Embedding æ¨¡å‹å…³é”®ä»£ç 

```python
class Qwen3Embeddings:
    def __init__(self, model_path="Qwen/Qwen3-Embedding-4B"):
        self.model = AutoModel.from_pretrained(
            model_path,
            torch_dtype=torch.float32,  # å…³é”®: ä½¿ç”¨ float32
            trust_remote_code=True,
            low_cpu_mem_usage=True
        ).eval()

        self.tokenizer = AutoTokenizer.from_pretrained(
            model_path,
            padding_side='right',  # ä¸ API ä¸€è‡´
            trust_remote_code=True
        )

    @staticmethod
    def _last_token_pool(last_hidden_states, attention_mask):
        """æ ‡å‡†åŒ–çš„ last token pooling"""
        sequence_lengths = attention_mask.sum(dim=1) - 1
        batch_size = last_hidden_states.shape[0]
        return last_hidden_states[torch.arange(batch_size), sequence_lengths]
```

### Reranker æ¨¡å‹å…³é”®é…ç½®

```python
class Qwen3Reranker4B:
    def __init__(self):
        self.model = AutoModelForCausalLM.from_pretrained(
            "Qwen/Qwen3-Reranker-4B",
            torch_dtype=torch.float32,  # MPS ä½¿ç”¨ float32
            trust_remote_code=True
        ).eval()

        self.tokenizer = AutoTokenizer.from_pretrained(
            "Qwen/Qwen3-Reranker-4B",
            padding_side='left'  # å…³é”®é…ç½®
        )

        # å…³é”® token è®¾ç½®
        self.token_false_id = self.tokenizer.convert_tokens_to_ids("no")
        self.token_true_id = self.tokenizer.convert_tokens_to_ids("yes")
```

### åˆ†æ•°å½’ä¸€åŒ–æ ¸å¿ƒç®—æ³•

```python
def polynomial_score_mapping(local_scores, api_scores):
    """å¤šé¡¹å¼åˆ†æ•°æ˜ å°„"""
    # 3æ¬¡å¤šé¡¹å¼å›å½’æ‹Ÿåˆ
    coefficients = np.polyfit(local_scores, api_scores, 3)
    poly_func = np.poly1d(coefficients)

    def normalize_scores(scores):
        normalized = poly_func(scores)
        # ç¡®ä¿åœ¨ [0, 1] èŒƒå›´å†…
        return np.clip(normalized, 0, 1)

    return normalize_scores
```

---

## ğŸš¨ é‡è¦è­¦å‘Šå’Œæ³¨æ„äº‹é¡¹

### Reranker 8B æ¨¡å‹è­¦å‘Š

**âš ï¸ ä¸¥é‡é—®é¢˜**:
```
æ¨¡å‹åŠ è½½æ—¶çš„è­¦å‘Šä¿¡æ¯:
"Some weights of Qwen3ForSequenceClassification were not initialized from the model checkpoint"
"You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference"
```

**æŠ€æœ¯å«ä¹‰**:
- æ¨¡å‹å¯èƒ½æ˜¯åŸºç¡€è¯­è¨€æ¨¡å‹ï¼Œæœªç» reranker ä¸“é—¨è®­ç»ƒ
- åˆ†ç±»å¤´æƒé‡æœªæ­£ç¡®åˆå§‹åŒ–
- éœ€è¦é¢å¤–çš„å¾®è°ƒæ‰èƒ½æ­£å¸¸å·¥ä½œ

**å»ºè®®**:
- ç­‰å¾…å®˜æ–¹å‘å¸ƒå®Œæ•´è®­ç»ƒçš„ 8B reranker ç‰ˆæœ¬
- æˆ–å¯»æ‰¾å…¶ä»–å‚å•†çš„ 8B reranker æ¨¡å‹
- å½“å‰é˜¶æ®µä½¿ç”¨å·²éªŒè¯çš„ 4B æ¨¡å‹

### éƒ¨ç½²ç¯å¢ƒè¦æ±‚

**ç¡¬ä»¶è¦æ±‚**:
```
Embedding 4B:
- å†…å­˜: 8GB+
- æ˜¾å­˜: 4GB+ (GPU)
- CPU: 8æ ¸+ (CPU éƒ¨ç½²)

Embedding 8B:
- å†…å­˜: 16GB+
- æ˜¾å­˜: 8GB+ (GPU)
- CPU: 16æ ¸+ (CPU éƒ¨ç½²)

Reranker 4B:
- å†…å­˜: 8GB+
- æ˜¾å­˜: 4GB+ (GPU)
- CPU: 8æ ¸+ (CPU éƒ¨ç½²)
```

**è½¯ä»¶ä¾èµ–**:
```
transformers>=4.51.0
torch>=2.0.0
numpy>=1.21.0
```

---

## ğŸ“š å‚è€ƒèµ„æº

### å®˜æ–¹æ–‡æ¡£
- [Qwen3-Embedding Hugging Face](https://huggingface.co/Qwen/Qwen3-Embedding-4B)
- [Qwen3-Reranker Hugging Face](https://huggingface.co/Qwen/Qwen3-Reranker-4B)
- [SiliconFlow API æ–‡æ¡£](https://docs.siliconflow.cn/)

### æŠ€æœ¯è®ºæ–‡
- Qwen3 Technical Report
- Transformer Architecture for Embedding and Reranking

### ç›¸å…³é¡¹ç›®
- æœ¬é¡¹ç›® GitHub ä»“åº“
- Qwen å®˜æ–¹ç¤ºä¾‹ä»£ç 
- ä¸€è‡´æ€§ä¼˜åŒ–æœ€ä½³å®è·µ

---

**é¡¹ç›®åœ†æ»¡å®Œæˆï¼ŒæŠ€æœ¯æ–¹æ¡ˆæˆç†Ÿå¯ç”¨ï¼** ğŸ‰

**æœ€åæ›´æ–°**: 2024å¹´12æœˆ
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æŠ€æœ¯è´Ÿè´£**: Augment Agent
